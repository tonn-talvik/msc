\documentclass[a4paper,12pt]{article}
\usepackage[lmargin=30mm,rmargin=30mm,tmargin=25mm,bmargin=25mm,showframe]{geometry}
\usepackage{mathptmx}% http://ctan.org/pkg/mathptmx

\usepackage[T1]{fontenc}
\usepackage{textcomp}
\usepackage{unicode-math}

%\setmathfont[Scale=0.85]{Lucida Bright Math OT}
%\setmathfont{TeX Gyre Pagella Math}


\usepackage{fancyhdr}
\fancypagestyle{FirstPage}{\fancyhf{}\renewcommand{\headrulewidth}{0pt}\fancyfoot[C]{Tallinn 2017}}

\renewcommand*\contentsname{\vskip 60pt\centering Sisukord}
\renewcommand*\listfigurename{\vskip 60pt\centering Jooniste loetelu}

\usepackage{biblatex}
\bibliography{thesis}

\usepackage{hyperref}

\usepackage[figure,table]{totalcount}

%\linespread{1.4}
%\renewcommand{\baselinestretch}{1.5}

\setlength{\parindent}{0pt}
\setlength{\parskip}{12pt}

\usepackage{titlesec}

% http://tex.stackexchange.com/questions/299969/titlesec-loss-of-section-numbering-with-the-new-update-2016-03-15
\usepackage{etoolbox}
\makeatletter
\patchcmd{\ttlh@hang}{\parindent\z@}{\parindent\z@\leavevmode}{}{}
\patchcmd{\ttlh@hang}{\noindent}{}{}{}
\makeatother

%\titleformat{\section}[block]{\color{blue}\Large\bfseries\filcenter}{}{1em}{}
\titlespacing*{\section}{0pt}{60pt}{18pt}
\titlespacing*{\subsection}{0pt}{24pt}{12pt}
% III tase: kiri 14pt, lõiguvahe enne ja pärast 12pt

\usepackage{underscore}
%\usepackage{fontspec}
%\setmonofont{Consolas}
\usepackage{listings}
%\usepackage{inconsolata}
\lstdefinelanguage{agda}{
  morekeywords={abstract,constructor,data,field,
    forall,hiding,import,in,infix,infixl,infixr,let,
    module,mutual,open,postulate,primitive,Prop,
    private,public,quoteGoal,quoteTerm,quote,record,
    renaming,rewrite,Set,syntax,unquote,using,where,with},
  keywordstyle=\bfseries,
  mathescape=true,
  basicstyle=\fontsize{11}{11}\selectfont\sffamily,
  %comment=[l]{--},
  morecomment=[s]{\{-}{-\}},
  escapechar=\&
}


\lstset{language=agda}

\usepackage{float}
\floatstyle{boxed} 
\restylefloat{figure}

\usepackage{caption}
\captionsetup[figure]{name=Joonis}


\renewcommand{\labelitemi}{$\smblksquare$}

\usepackage{setspace}
\begin{document}
\onehalfspacing

% ------------------------------------------------------------
  \begin{center}
    \textsc{tallinna tehnikaülikool}\\
    Infotehnoloogia teaduskond\\
    Arvutiteaduse instituut\\
    \vfill
    
    Tõnn Talvik 132619IAPM
    \vskip 3em 
    \LARGE\textsc{efekti analüüside ja nendel põhinevate programmiteisenduste sertifitseerimine}\\
    \normalsize\vskip 4em 
    Magistritöö\\
    \vskip 4em    
  \end{center}
  
  \begin{flushright}
    \begin{tabular}{ r l }
      Juhendaja:& Tarmo Uustalu\\
      & Professor \\
    \end{tabular}
    \vfill
  \end{flushright}
  
  \thispagestyle{FirstPage}
  \clearpage
  \setcounter{page}{2}
% ------------------------------------------------------------

\section*{\vskip 60pt\centering Autorideklaratsioon}

Kinnitan, et olen koostanud antud lõputöö iseseisvalt ning seda ei ole kellegi teise poolt varem kaitsmisele esitatud. Kõik töö koostamisel kasutatud teiste autorite tööd, olulised seisukohad, kirjandusallikatest ja mujalt pärinevad andmed on töös viidatud.

Autor: Tõnn Talvik

8. mai 2017
\clearpage

\section*{\vskip 60pt\centering Annotatsioon}
[tekst]
         
Lõputöö on kirjutatud eesti keeles ning sisaldab teksti [lehekülgede arv töö põhiosas] leheküljel, [peatükkide arv] peatükki, \totalfigures\ joonist, [tabelite arv] tabelit.
\clearpage

\section*{\vskip 60pt\centering Abstract\\
Certification of effect analysis and program transformations based on the analysis}
[text]
The thesis is in Estonian and contains [pages] pages of text, [chapters] chapters, \totalfigures\ figures, [tables] tables.
\clearpage

\tableofcontents
\clearpage

\listoffigures
\clearpage







\section{Sissejuhatus}

% background and motivation?
Taust: efektid ja monaadid. Moggi, Benton, Katsumata.

% https://courses.cs.ttu.ee/pages/Problem_Statement

Töö eesmärgiks on realiseerida sõltuvate tüüpidega programmeerimiskeeles Agda idee tõestus taseme
raamistu efektide analüüsiks ja nendele põhinevateks programmiteisendusteks.
Samas raamistus peab saama näidata, et need analüüsid ja teisendused on korrektsed.
% Sissejuhatuses tutvustab autor töö teemat, töö eesmärke, lahendatavat probleemistikku,
% andes samuti ülevaate töö ülesehitusest. Sissejuhatuses kirjeldatakse ka töö
% lähtetingimused, alamülesanded ja vajadusel ka täiendavad nõuded (vt jaotist 2.4 ).

% Lõputöös peab sisalduma selge lõpetaja poolt lahendatava ülesande püstitus.

% Magistritöös esitatakse lahendatava ülesande püstitus töö sissejuhatuses, kattes järgmised punktid:
% - töös lahendatavad küsimused ja lähtetingimused,
% - eritingimused, mida on rakendatud ülesande lahendamisel/ülesande püstitamisel.

% Reproducibility
Töö käigus valminud lähtekood on tulemuste reprodutseerimiseks allalaetav aadressilt \url{https://github.com/tonn-talvik/msc}.
Lähtekoodi kompileerimiseks on kasutatud Agda versiooni 2.5.1.1 koos standardteegi versiooniga 0.12.
Mainitud tarkvarapaketid on tasuta installeeritavad Ubuntu 16.04 LTS jt varamutest.


\clearpage

\section{Erandid}

\subsection{Eranditega keel}
Baaskeeleks on tüübitud lambda-arvutus koos tõeväärtuste, naturaalarvude ja korrutistega.
Keele laienduseks on erandid.

Vastastikku defineeritud väärtus- ja arvutustüübid on toodud joonisel \ref{fig:exc.types}.
Lubatud väärtustüübid VType on naturaalarvud, tõeväärtused, teiste väärtustüüpide korrutised ja tüübitud lambda-arvutused.
Arvutustüüpideks on efektiga E annoteeritud väärtustüübid. Efekt E on defineeritud peatükis \ref{ssec:exc.grading}.
\begin{figure}
  \begin{lstlisting}
mutual
  data VType : Set where
    nat : VType
    bool : VType
    _$∏$_ : VType →  VType → VType
    _$⟹$_ : VType →&\ &CType →&\ &VType

  data CType : Set where
    _/_ : E → VType → CType
  \end{lstlisting}
  \caption{Eranditega keele tüübid.}
  \label{fig:exc.types}
\end{figure}


Vastastikku defineeritud väärtus- ja arvutustermid on toodud joonisel \ref{fig:exc.raw}.
% pragmatics
Termide konstruktorite nimetamisel on kasutatud suurtähti vältimaks võimalikke nimekonflikte Agda standard funktsioonidega.
Järgnevalt on selgitatud konstruktorite tähendust.
\begin{itemize}
  \item TT ja FF koostavad vastavalt tõeväärtused tõene ja väär.
  \item ZZ koostab naturaalarvu 0 ja konstruktor SS oma argumendist järgneva naturaalarvu.
  \item $⟨$_,_$⟩$ koostab oma argumentide paari e. korrutise.
  \item FST ja SND koostavad vastavalt argumendina antud korrutise esimese ja teise projektsiooni.
  \item VAR koostab De Bruijn'i indeksiga määratud muutuja.
  \item LAM on funktsiooni abstraktsioon, seejuures funktsiooni kehaks on arvutusterm
\end{itemize}



\begin{figure}
  \begin{lstlisting}
mutual
  data vTerm : Set where
    TT FF : vTerm
    ZZ : vTerm
    SS : vTerm → vTerm
    $⟨$_,_$⟩$ : vTerm →  vTerm → vTerm
    FST SND : vTerm → vTerm
    VAR : $ℕ$ →  vTerm
    LAM : VType → cTerm → vTerm

  data cTerm : Set where
    VAL : vTerm → cTerm
    FAIL : VType → cTerm
    TRY_WITH_ : cTerm → cTerm → cTerm
    IF_THEN_ELSE_ : vTerm → cTerm → cTerm → cTerm
    _&\$&_ : vTerm → vTerm → cTerm
    PREC : vTerm → cTerm → cTerm → cTerm
    LET_IN_ : cTerm → cTerm → cTerm

  \end{lstlisting}
  \caption{Eranditega keele väärtus- ja arvutustermid.}
  \label{fig:exc.raw}
\end{figure}


\subsection{Erandite gradeering} \label{ssec:exc.grading}
asoe hut

\begin{figure}
  \begin{lstlisting}
data Exc : Set where
  err : Exc
  ok : Exc -- kommentaar
  errok : Exc

  \end{lstlisting}
  \caption{Erandite andmetüübi konstruktorid.}
\end{figure}

\subsection{Tüübituletus}
_f_ : a → b\[
∀X [ ∅ ∉ X ⇒ ∃f:X ⟶  ⋃ X\ ∀A ∈ X (f(A) ∈ A )λ ∀ ∃ ⟦ ⟪ · ⊔ ⊓ Γ ρ ε  ⊑   ¬ ≡ ≢ ≤ ≰ ∏ ⇒  ℕ ]\]
\begin{figure}
  \begin{lstlisting}
  private
  data _$⊑$_ : Exc →  Exc → Set where
    $⊑$-refl : {e : Exc} →  e $⊑$ e
    err$⊑$errok : err $⊑$ errok
    ok$⊑$errok : ok ⊑ errok
$λ ∀ ∃ ⟦ ⟧ ⟪ ⟫ · ⊔ ⊓ Γ ρ ε   ¬ ≡ ≢ ≤ ≰ ∏ ⇒ \_  ℕ $
  {-
  data Exc : Set where
    err : Exc
    ok : Exc -- kommentaar 
    errok : Exc
  -}
  \end{lstlisting}
  \caption{Erandite andmetüübi konstruktorid.}
\end{figure}

aoeu
\subsection{Semantika}
aoeu
\subsection{Optimisatsioonid}
aeoust haoseu th

\clearpage

\section{Mitte-deterministlik keel}
aseo huasousato usaoheu s
This is obvious \cite{Benton2016}. \cite{Katsumata2014}

\clearpage

\section{Võimalikud edasiarendused}

- muteeritava oleku laiendused\\
- mittedeterminismi teine gradeering nd0,1,01,1+,N ja selle optimisatsioonid (pure-lambda-hoist, dead-computation)

\clearpage

\section{Kokkuvõte}
Kokkuvõttes esitab autor töö põhieesmärgi, vastused sissejuhatuses püstitatud
küsimustele, toob välja töö olulisemad tulemused ja järeldused.

\clearpage

\renewcommand{\baselinestretch}{1.15}
\fontsize{11}{11}\selectfont
\printbibliography[title={\vskip 60pt\centering Kasutatud kirjandus}]

\end{document}
